import{d as Se}from"./chunk-BS6XHXOG.js";import{a as re}from"./chunk-MQGUF25V.js";import{b as o,c as i,d as r,e as h,f as ge,g as u}from"./chunk-YJ5RMHHJ.js";var x={shareAllNewRenderers:"auto",showRenderStats:!1};function ft(t){for(let[e,s]of Object.entries(t))e in x&&(x[e]=s)}var B,A,Ee,Fe=(Ee=class{constructor(){r(this,B,0);r(this,A,0)}queue(t){return new Promise(async(e,s)=>{try{let a=++ge(this,B)._,n=await t;a>i(this,A)&&(h(this,A,a),e(n))}catch(a){s(a)}})}},B=new WeakMap,A=new WeakMap,Ee),ke=0,w,E,U,Xe,g,q,_e,R,Re,Ae=(Re=class{constructor(){r(this,U);r(this,q);r(this,w,new Set);o(this,"lastSourceGeneration",0);r(this,E,new Set);r(this,g,!1);r(this,R,new Map)}canReuse(t,e){return t===e||this.canReuseValue(t,e)}canReuseValue(t,e){return!1}debugGetChildren(){return Array.from(i(this,w).values())}addChild(t){i(this,w).add(t)}removeChild(t){i(this,w).delete(t)}markStale(t){if(t.detail.generation!==ke)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==t.detail.generation){this.lastSourceGeneration=t.detail.generation;for(let e of i(this,w))e.markStale(t);u(this,U,Xe).call(this)}}addRawListener(t,e){i(this,E).add(t),e?.initial&&t()}removeRawListener(t){i(this,E).delete(t)}addFreshListener(t){let e=new Fe,s=null,a=async()=>{let n=await e.queue(this.get());s!==null&&this.canReuse(s,n)||(s=n,t(n))};i(this,R).set(t,a),this.addRawListener(a,{initial:!0})}removeFreshListener(t){this.removeRawListener(i(this,R).get(t)),i(this,R).delete(t)}},w=new WeakMap,E=new WeakMap,U=new WeakSet,Xe=function(){i(this,g)||(h(this,g,!0),setTimeout(()=>u(this,q,_e).call(this),0))},g=new WeakMap,q=new WeakSet,_e=function(){if(!i(this,g))throw new Error("Invalid dispatch state!");for(let t of i(this,E))t();h(this,g,!1)},R=new WeakMap,Re),p,Me,Ue=(Me=class extends Ae{constructor(e){super();r(this,p,void 0);h(this,p,re(()=>this.getDefaultValue())),e&&h(this,p,this.deriveFromPromiseOrValue(e,i(this,p)))}set(e){h(this,p,this.deriveFromPromiseOrValue(e,i(this,p)));let s={sourceProp:this,value:i(this,p),generation:++ke};this.markStale(new CustomEvent("stale",{detail:s}))}async get(){return i(this,p)}async deriveFromPromiseOrValue(e,s){return this.derive(await e,s)}},p=new WeakMap,Me),qe=class extends Ue{derive(t){return t}},vt=Symbol("no value"),f,X,M,$,Oe,j,He,Ce,wt=(Ce=class extends Ae{constructor(e,s){super();r(this,$);r(this,j);r(this,f,void 0);r(this,X,null);r(this,M,null);this.userVisibleErrorTracker=s,h(this,f,e);for(let a of Object.values(e))a.addChild(this)}async get(){let e=this.lastSourceGeneration;if(i(this,M)?.generation===e)return i(this,M).output;let s={generation:e,output:u(this,j,He).call(this,u(this,$,Oe).call(this),e,i(this,X))};return h(this,M,s),this.userVisibleErrorTracker?.reset(),s.output}},f=new WeakMap,X=new WeakMap,M=new WeakMap,$=new WeakSet,Oe=async function(){let e={};for(let[a,n]of Object.entries(i(this,f)))e[a]=n.get();let s={};for(let a in i(this,f))s[a]=await e[a];return s},j=new WeakSet,He=async function(e,s,a=null){let n=await e,l=d=>(h(this,X,{inputs:n,output:Promise.resolve(d),generation:s}),d);if(!a)return l(await this.derive(n));let m=a.inputs;for(let d in i(this,f))if(!i(this,f)[d].canReuse(n[d],m[d]))return l(await this.derive(n));return a.output},Ce),C,Pe,gt=(Pe=class{constructor(){r(this,C,[])}addListener(t,e){let s=!1,a=n=>{s||e(n)};t.addFreshListener(a),i(this,C).push(()=>{t.removeFreshListener(a),s=!0})}addMultiListener3(t,e){this.addMultiListener(t,e)}addMultiListener(t,e){let s=!1,a=t.length-1,n=async l=>{if(a>0){a--;return}if(s)return;let m=t.map(W=>W.get()),d=await Promise.all(m);e(d)};for(let l of t)l.addFreshListener(n);i(this,C).push(()=>{for(let l of t)l.removeFreshListener(n);s=!0})}disconnect(){for(let t of i(this,C))t()}},C=new WeakMap,Pe),Ye=class{constructor(t){o(this,"animFrameID",null);o(this,"animFrame",this.animFrameWrapper.bind(this));this.callback=t}requestIsPending(){return!!this.animFrameID}requestAnimFrame(){this.animFrameID||(this.animFrameID=requestAnimationFrame(this.animFrame))}cancelAnimFrame(){this.animFrameID&&(cancelAnimationFrame(this.animFrameID),this.animFrameID=0)}animFrameWrapper(t){this.animFrameID=0,this.callback(t)}},St={floating:!0,none:!0},yt=class extends qe{getDefaultValue(){return"auto"}},$e=Math.PI*2,N=360/$e,je=class{},ce;globalThis.HTMLElement?ce=globalThis.HTMLElement:ce=je;var Ke=class{define(){}},G;globalThis.customElements?G=globalThis.customElements:G=new Ke;var me,Je=class{replaceSync(){}};globalThis.CSSStyleSheet?me=globalThis.CSSStyleSheet:me=Je;var Ve=class extends ce{constructor(e){super();o(this,"shadow");o(this,"contentWrapper");this.shadow=this.attachShadow({mode:e?.mode??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}addCSS(e){this.shadow.adoptedStyleSheets.push(e)}removeCSS(e){let s=this.shadow.adoptedStyleSheets.indexOf(e);typeof s<"u"&&this.shadow.adoptedStyleSheets.splice(s,s+1)}addElement(e){return this.contentWrapper.appendChild(e)}prependElement(e){this.contentWrapper.prepend(e)}removeElement(e){return this.contentWrapper.removeChild(e)}};G.define("twisty-managed-custom-element",Ve);var F=globalThis.performance,Qe=class{constructor(){o(this,"mode",0);o(this,"dom",document.createElement("div"));o(this,"beginTime",(F||Date).now());o(this,"prevTime",this.beginTime);o(this,"frames",0);o(this,"fpsPanel",this.addPanel(new he("FPS","#0ff","#002")));o(this,"msPanel",this.addPanel(new he("MS","#0f0","#020")));o(this,"memPanel",F?.memory?this.addPanel(new he("MB","#f08","#201")):null);o(this,"REVISION",16);this.dom.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",this.dom.addEventListener("click",t=>{t.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.showPanel(0)}addPanel(t){return this.dom.appendChild(t.dom),t}showPanel(t){for(let e=0;e<this.dom.children.length;e++)this.dom.children[e].style.display=e===t?"block":"none";this.mode=t}begin(){this.beginTime=(F||Date).now()}end(){this.frames++;let t=(F||Date).now();if(this.msPanel.update(t-this.beginTime,200),t>=this.prevTime+1e3&&(this.fpsPanel.update(this.frames*1e3/(t-this.prevTime),100),this.prevTime=t,this.frames=0,this.memPanel)){let e=F.memory;this.memPanel.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t}update(){this.beginTime=this.end()}},c=Math.round(globalThis?.window?.devicePixelRatio??1),oe=80*c,ye=48*c,Te=3*c,be=2*c,T=3*c,v=15*c,b=74*c,I=30*c,he=class{constructor(t,e,s){o(this,"min",1/0);o(this,"max",0);o(this,"dom",document.createElement("canvas"));o(this,"context",this.dom.getContext("2d"));this.name=t,this.fg=e,this.bg=s,this.dom.width=oe,this.dom.height=ye,this.dom.style.cssText="width:80px;height:48px",this.context.font=`bold ${9*c}px Helvetica,Arial,sans-serif`,this.context.textBaseline="top",this.context.fillStyle=s,this.context.fillRect(0,0,oe,ye),this.context.fillStyle=e,this.context.fillText(t,Te,be),this.context.fillRect(T,v,b,I),this.context.fillStyle=s,this.context.globalAlpha=.9,this.context.fillRect(T,v,b,I)}update(t,e){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,oe,v),this.context.fillStyle=this.fg,this.context.fillText(`${Math.round(t)} ${this.name} (${Math.round(this.min)}-${Math.round(this.max)})`,Te,be),this.context.drawImage(this.dom,T+c,v,b-c,I,T,v,b-c,I),this.context.fillRect(T+b-c,v,c,I),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(T+b-c,v,c,Math.round((1-t/e)*I))}},Ze=null;async function et(){return Ze??(Ze=import("./twisty-dynamic-3d-TINH44QH-LSLO2OGL.js"))}var z=re(async()=>(await et()).T3I),tt=null;function ue(){return tt??(devicePixelRatio||1)}var We=new me;We.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  place-content: center;
  contain: strict;
}

.loading {
  width: 4em;
  height: 4em;
  border-radius: 2.5em;
  border: 0.5em solid rgba(0, 0, 0, 0);
  border-top: 0.5em solid rgba(0, 0, 0, 0.7);
  border-right: 0.5em solid rgba(0, 0, 0, 0.7);
  animation: fade-in-delayed 4s, rotate 1s linear infinite;
}

@keyframes fade-in-delayed {
  0% { opacity: 0; }
  25% {opacity: 0; }
  100% { opacity: 1; }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* TODO: This is due to stats hack. Replace with \`canvas\`. */
.wrapper > canvas {
  max-width: 100%;
  max-height: 100%;
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.wrapper.invisible {
  opacity: 0;
}

.wrapper.drag-input-enabled > canvas {
  cursor: grab;
}

.wrapper.drag-input-enabled > canvas:active {
  cursor: grabbing;
}
`);var Ie=.1,S,y,P,K,Ne,J,Ge,_,pe,Le,st=(Le=class extends EventTarget{constructor(e){super();r(this,K);r(this,J);r(this,_);r(this,S,new Map);r(this,y,new Map);r(this,P,!1);this.target=e}start(){this.addTargetListener("pointerdown",this.onPointerDown.bind(this)),this.addTargetListener("contextmenu",e=>{e.preventDefault()}),this.addTargetListener("touchmove",e=>e.preventDefault()),this.addTargetListener("dblclick",e=>e.preventDefault())}stop(){for(let[e,s]of i(this,y).entries())this.target.removeEventListener(e,s);i(this,y).clear(),h(this,P,!1)}addTargetListener(e,s){i(this,y).has(e)||(this.target.addEventListener(e,s),i(this,y).set(e,s))}onPointerDown(e){u(this,K,Ne).call(this);let s={attachedInfo:{},hasMoved:!1,lastClientX:e.clientX,lastClientY:e.clientY,lastTimeStamp:e.timeStamp};i(this,S).set(e.pointerId,s),this.target.setPointerCapture(e.pointerId)}onPointerMove(e){let s=u(this,_,pe).call(this,e).movementInfo;s&&(e.preventDefault(),this.dispatchEvent(new CustomEvent("move",{detail:s})))}onPointerUp(e){let s=u(this,_,pe).call(this,e),a=i(this,S).get(e.pointerId);u(this,J,Ge).call(this,e),this.target.releasePointerCapture(e.pointerId);let n;if(s.hasMoved)n=new CustomEvent("up",{detail:{attachedInfo:a.attachedInfo}});else{let{altKey:l,ctrlKey:m,metaKey:d,shiftKey:W}=e;n=new CustomEvent("press",{detail:{normalizedX:e.offsetX/this.target.offsetWidth*2-1,normalizedY:1-e.offsetY/this.target.offsetHeight*2,rightClick:!!(e.button&2),keys:{altKey:l,ctrlOrMetaKey:m||d,shiftKey:W}}})}this.dispatchEvent(n)}},S=new WeakMap,y=new WeakMap,P=new WeakMap,K=new WeakSet,Ne=function(){i(this,P)||(this.addTargetListener("pointermove",this.onPointerMove.bind(this)),this.addTargetListener("pointerup",this.onPointerUp.bind(this)),h(this,P,!0))},J=new WeakSet,Ge=function(e){i(this,S).delete(e.pointerId)},_=new WeakSet,pe=function(e){let s=i(this,S).get(e.pointerId);if(!s)return{movementInfo:null,hasMoved:!1};let a;return(e.movementX??0)!==0||(e.movementY??0)!==0?a={attachedInfo:s.attachedInfo,movementX:e.movementX,movementY:e.movementY,elapsedMs:e.timeStamp-s.lastTimeStamp}:a={attachedInfo:s.attachedInfo,movementX:e.clientX-s.lastClientX,movementY:e.clientY-s.lastClientY,elapsedMs:e.timeStamp-s.lastTimeStamp},s.lastClientX=e.clientX,s.lastClientY=e.clientY,s.lastTimeStamp=e.timeStamp,Math.abs(a.movementX)<Ie&&Math.abs(a.movementY)<Ie?{movementInfo:null,hasMoved:s.hasMoved}:(s.hasMoved=!0,{movementInfo:a,hasMoved:s.hasMoved})},Le),k=[];async function at(t,e,s,a){k.length===0&&k.push(we());let n=await k[0];return n.setSize(t,e),n.render(s,a),n.domElement}async function it(t,e,s,a,n){if(t===0||e===0)return;k.length===0&&k.push(we());let l=await at(t,e,a,n),m=s.getContext("2d");m.clearRect(0,0,s.width,s.height),m.drawImage(l,0,0)}async function we(){let t=(await z).WebGLRenderer,e=new t({antialias:!0,alpha:!0});return e.outputColorSpace=Se,e.setPixelRatio(ue()),e}var nt=!0,le=500,rt=50,ot=.75;function xe(t){return(Math.exp(1-t)-(1-t))/(1-Math.E)+1}var ht=class{constructor(t,e,s,a){o(this,"scheduler",new Ye(this.render.bind(this)));o(this,"lastTimestamp");this.startTimestamp=t,this.momentumX=e,this.momentumY=s,this.callback=a,this.scheduler.requestAnimFrame(),this.lastTimestamp=t}render(t){let e=(this.lastTimestamp-this.startTimestamp)/le,s=Math.min(1,(t-this.startTimestamp)/le);if(e===0&&s>rt/le)return;let a=xe(s)-xe(e);this.callback(this.momentumX*a*1e3,this.momentumY*a*1e3),s<1&&this.scheduler.requestAnimFrame(),this.lastTimestamp=t}},lt=class{constructor(t,e,s,a){o(this,"experimentalInertia",nt);o(this,"onMovementBound",this.onMovement.bind(this));o(this,"experimentalHasBeenMoved",!1);this.model=t,this.mirror=e,this.canvas=s,this.dragTracker=a,this.dragTracker.addEventListener("move",this.onMove.bind(this)),this.dragTracker.addEventListener("up",this.onUp.bind(this))}temperMovement(t){return Math.sign(t)*Math.log(Math.abs(t*10)+1)/6}onMove(t){var n;(n=t.detail).attachedInfo??(n.attachedInfo={});let{temperedX:e,temperedY:s}=this.onMovement(t.detail.movementX,t.detail.movementY),a=t.detail.attachedInfo;a.lastTemperedX=e*10,a.lastTemperedY=s*10,a.timestamp=t.timeStamp}onMovement(t,e){let s=this.mirror?-1:1,a=Math.min(this.canvas.offsetWidth,this.canvas.offsetHeight),n=this.temperMovement(t/a),l=this.temperMovement(e/a*ot);return this.model.twistySceneModel.orbitCoordinatesRequest.set((async()=>{let m=await this.model.twistySceneModel.orbitCoordinates.get();return{latitude:m.latitude+2*l*N*s,longitude:m.longitude-2*n*N}})()),{temperedX:n,temperedY:l}}onUp(t){t.preventDefault(),"lastTemperedX"in t.detail.attachedInfo&&"lastTemperedY"in t.detail.attachedInfo&&"timestamp"in t.detail.attachedInfo&&t.timeStamp-t.detail.attachedInfo.timestamp<60&&new ht(t.timeStamp,t.detail.attachedInfo.lastTemperedX,t.detail.attachedInfo.lastTemperedY,this.onMovementBound)}};async function dt(t,e,s=!1){let a=new(await z).Spherical(e.distance,(90-(s?-1:1)*e.latitude)/N,((s?180:0)+e.longitude)/N);a.makeSafe(),t.position.setFromSpherical(a),t.lookAt(0,0,0)}var de=0,ct=2,ze=!1;function mt(){return x.shareAllNewRenderers!=="auto"?(x.shareAllNewRenderers||de++,x.shareAllNewRenderers!=="never"):de<ct?(de++,!1):(ze=!0,!0)}function bt(){return ze}var Q,Be,Z,O,H,Y,fe,ee,te,se,V,ve,ae,ie,L,D,ne,De,ut=(De=class extends Ve{constructor(e,s,a){super();r(this,Q);r(this,Y);r(this,V);o(this,"scene",null);o(this,"stats",null);o(this,"rendererIsShared",mt());o(this,"loadingElement",null);r(this,Z,new Fe);r(this,O,0);r(this,H,0);r(this,ee,null);r(this,te,null);r(this,se,null);r(this,ae,null);r(this,ie,null);r(this,L,[]);r(this,D,null);r(this,ne,new Ye(this.render.bind(this)));this.model=e,this.options=a,this.scene=s??null,this.loadingElement=this.addElement(document.createElement("div")),this.loadingElement.classList.add("loading"),x.showRenderStats&&(this.stats=new Qe,this.stats.dom.style.position="absolute",this.contentWrapper.appendChild(this.stats.dom))}async connectedCallback(){this.addCSS(We),this.addElement((await this.canvasInfo()).canvas),u(this,Y,fe).call(this),new ResizeObserver(u(this,Y,fe).bind(this)).observe(this.contentWrapper),this.orbitControls(),u(this,Q,Be).call(this),this.scheduleRender()}async clearCanvas(){if(this.rendererIsShared){let e=await this.canvasInfo();e.context.clearRect(0,0,e.canvas.width,e.canvas.height)}else{let s=(await this.renderer()).getContext();s.clear(s.COLOR_BUFFER_BIT)}}async renderer(){if(this.rendererIsShared)throw new Error("renderer expected to be shared.");return i(this,ee)??h(this,ee,we())}async canvasInfo(){return i(this,te)??h(this,te,(async()=>{let e;if(this.rendererIsShared)e=this.addElement(document.createElement("canvas"));else{let a=await this.renderer();e=this.addElement(a.domElement)}this.loadingElement?.remove();let s=e.getContext("2d");return{canvas:e,context:s}})())}async camera(){return i(this,ae)??h(this,ae,(async()=>{let e=new(await z).PerspectiveCamera(20,1,.1,20);return e.position.copy(new(await z).Vector3(2,4,4).multiplyScalar(this.options?.backView?-1:1)),e.lookAt(0,0,0),e})())}async orbitControls(){return i(this,ie)??h(this,ie,(async()=>{let e=new lt(this.model,!!this.options?.backView,(await this.canvasInfo()).canvas,await u(this,V,ve).call(this));return this.model&&this.addListener(this.model.twistySceneModel.orbitCoordinates,async s=>{let a=await this.camera();dt(a,s,this.options?.backView),this.scheduleRender()}),e})())}addListener(e,s){e.addFreshListener(s),i(this,L).push(()=>{e.removeFreshListener(s)})}disconnect(){for(let e of i(this,L))e();h(this,L,[])}experimentalNextRenderFinishedCallback(e){h(this,D,e)}async render(){var n;if(!this.scene)throw new Error("Attempted to render without a scene");this.stats?.begin();let[e,s,a]=await Promise.all([this.scene.scene(),this.camera(),this.canvasInfo()]);this.rendererIsShared?it(i(this,O),i(this,H),a.canvas,e,s):(await this.renderer()).render(e,s),this.stats?.end(),(n=i(this,D))==null||n.call(this),h(this,D,null)}scheduleRender(){i(this,ne).requestAnimFrame()}},Q=new WeakSet,Be=async function(){(await u(this,V,ve).call(this)).addEventListener("press",async s=>{await this.model.twistySceneModel.movePressInput.get()==="basic"&&this.dispatchEvent(new CustomEvent("press",{detail:{pressInfo:s.detail,cameraPromise:this.camera()}}))})},Z=new WeakMap,O=new WeakMap,H=new WeakMap,Y=new WeakSet,fe=async function(){let e=await i(this,Z).queue(this.camera()),s=this.contentWrapper.clientWidth,a=this.contentWrapper.clientHeight;h(this,O,s),h(this,H,a);let n=0,l=0,m=0;if(a>s&&(m=a-s,l=-Math.floor(.5*m)),e.aspect=s/a,e.setViewOffset(s,a-m,n,l,s,a),e.updateProjectionMatrix(),this.clearCanvas(),this.rendererIsShared){let d=await this.canvasInfo();d.canvas.width=s*ue(),d.canvas.height=a*ue(),d.canvas.style.width=`${s.toString()}px`,d.canvas.style.height=`${a.toString()}px`}else(await this.renderer()).setSize(s,a,!0);this.scheduleRender()},ee=new WeakMap,te=new WeakMap,se=new WeakMap,V=new WeakSet,ve=async function(){return i(this,se)??h(this,se,(async()=>{let e=new st((await this.canvasInfo()).canvas);return this.model?.twistySceneModel.dragInput.addFreshListener(s=>{let a=!1;switch(s){case"auto":{e.start(),a=!0;break}case"none":{e.stop();break}}this.contentWrapper.classList.toggle("drag-input-enabled",a)}),e})())},ae=new WeakMap,ie=new WeakMap,L=new WeakMap,D=new WeakMap,ne=new WeakMap,De);G.define("twisty-3d-vantage",ut);export{ft as a,Fe as b,Ue as c,qe as d,vt as e,wt as f,gt as g,Ye as h,St as i,yt as j,$e as k,N as l,ce as m,G as n,me as o,Ve as p,et as q,z as r,at as s,dt as t,bt as u,ut as v};
//# sourceMappingURL=chunk-LGCLU4JF.js.map
